<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–Ø–¥–∑–∏ (Yahtzee) - Web</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: sans-serif; background: #2c3e50; color: #fff; margin: 0; padding: 0; }
    .container { max-width: 900px; margin: 0 auto; padding: 26px; }
    h1 { text-align: center; margin-bottom: 12px;}

    .tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 8px; }
    .tab-btn {
      background: #fff; color: #2980b9; border: none; padding: 10px 24px;
      border-radius: 7px 7px 0 0; cursor: pointer; font-size: 1.05em;
      border-bottom: 2px solid #eee; margin-bottom: -2px;
      transition: background 0.2s, color 0.2s;
    }
    .tab-btn.active { background: #2980b9; color: #fff; border-bottom: 2px solid #2980b9; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .top-actions { display:flex; gap:8px; justify-content:center; margin: 8px 0 14px; flex-wrap:wrap; }
    .top-actions .btn { min-width: 220px; text-align: center; }

    /* –ü—Ä–∞–≤–∏–ª–∞ */
    #rules { justify-content: center; align-items: flex-start; padding: 20px; }
    #rules.tab-content.active { display: flex !important; }
    .rules-box {
      background: #fff; color: #000; padding: 20px 30px; border-radius: 10px;
      max-width: 600px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); line-height: 1.6;
    }
    .rules-box h2 { text-align: center; margin-bottom: 15px; }

    .dice-row { display: flex; gap: 10px; justify-content: center; margin-bottom: 18px;}
    .dice { width: 60px; height: 60px; background: #fff; color: #222; border-radius: 14px; box-shadow: 0 2px 8px #0004; display: flex; align-items: center; justify-content: center; font-size: 2.7rem; cursor: pointer; border: 3px solid transparent; transition: border 0.2s;}
    .dice.selected { border: 3px solid #27ae60;}

    .score-table { margin: 16px auto; max-width: 720px; border-collapse: collapse; background:#fff; color:#000;}
    .score-table th, .score-table td { border: 1px solid #666; padding: 7px 14px; text-align: center;}
    .score-table th { background: #34495e; color:#fff;}
    .score-table .available { cursor: pointer; background: #23aaff44;}
    .score-table .bonus { background: #39b54a99; color:#fff;}
    .upper-bonus { background:#2ecc40 !important; color:#fff !important; }

    /* ‚Äî‚Äî‚Äî Chips for possible moves ‚Äî‚Äî‚Äî */
    .chips-title { text-align:center; font-weight:700; font-size:1.25rem; margin: 10px 0 12px; }
    .chips { display:flex; flex-wrap:wrap; gap:12px; justify-content:center; }
    .chip {
      background:#27485d; color:#fff; border:2px solid #3aa0df;
      padding:12px 18px; border-radius:14px; font-size:1.05rem; font-weight:600;
      cursor:pointer; box-shadow:0 2px 8px rgba(0,0,0,.25); transition:transform .12s, box-shadow .12s;
    }
    .chip:hover { transform: translateY(-1px); box-shadow:0 4px 12px rgba(0,0,0,.3); }
    .chip:active { transform: translateY(0); box-shadow:0 2px 8px rgba(0,0,0,.25); }
    .chip .chip-score { opacity:.9; font-weight:700; margin-left:4px; }

    @media (max-width: 700px) {
      .chip { font-size:1rem; padding:10px 14px; }
      .chips { gap:10px; }
    }

    .btn { background: #2980b9; color: #fff; border: none; padding: 12px 32px; border-radius: 8px; cursor: pointer; font-size: 1.05rem; transition: background 0.2s;}
    .btn[disabled] { background: #666; cursor: not-allowed;}

    .turn-panel { text-align: center; margin: 13px 0 23px;}
    .msg { text-align: center; margin-bottom: 18px; font-size: 1.05rem;}

    .hide { display: none; }
    .finish { background: #3c990f; color: #fff; padding: 24px 12px; border-radius: 16px; text-align: center; font-size: 1.5rem; margin: 20px;}

    @media (max-width: 700px) {
      .container { padding: 10px; }
      .score-table { font-size: 0.95em;}
      .dice { width: 44px; height: 44px; font-size: 1.8em;}
      .tab-btn { padding: 8px 12px; font-size: 0.95em;}
    }

    /* modal */
    #name-modal {position:fixed;top:0;left:0;width:100%;height:100%;background:#000b;display:flex;align-items:center;justify-content:center;z-index:9999;}
    #name-modal .card {background:#fff;color:#000;padding:20px 30px;border-radius:12px;text-align:center;max-width: 90%;}
    #name-modal input {padding:10px;width:240px;font-size:1rem;}

    /* toast */
    #toast {position: fixed; left: 50%; bottom: 30px; transform: translateX(-50%); background: #000c; color: #fff; padding: 10px 14px; border-radius: 8px; display:none;}
  /* ====== –î–≤–µ –∫–æ–ª–æ–Ω–∫–∏ —Ä–µ–∫–æ—Ä–¥–æ–≤: —Å–ª–µ–≤–∞ –ö–ª–∞—Å—Å–∏–∫–∞, —Å–ø—Ä–∞–≤–∞ 1 —Ä–∞—É–Ω–¥ ====== */
.records-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 14px;
  align-items: start;
}
@media (max-width: 800px) {
  .records-grid { grid-template-columns: 1fr; }
}
.badge {
  display: inline-block;
  background: #2980b9;
  color: #fff;
  padding: 6px 10px;
  border-radius: 8px;
  margin-bottom: 8px;
  font-weight: 700;
}
.note {
  font-size: .95rem;
  color: #cfe9ff;
  margin-bottom: 8px;
}
  /* —Å–ø–∏—Å–æ–∫ —Ä–µ–∫–æ—Ä–¥–æ–≤ –±–µ–∑ <table> ‚Äî —á—Ç–æ–±—ã –Ω–µ –ª–æ–≤–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã —Å tr/td */
.lb-list { width: 100%; margin-top: 8px; }
.lb-row { display: grid; grid-template-columns: 60px 1fr 100px 180px; gap: 10px;
  padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,.12);
}
.lb-row.head { font-weight: 700; background: rgba(255,255,255,.06); border-radius: 8px; }
.lb-cell { overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
@media (max-width: 900px) {
  .lb-row { grid-template-columns: 50px 1fr 80px 140px; }
}
@media (max-width: 600px) {
  .lb-row { grid-template-columns: 42px 1fr 70px; }
  .lb-cell.date { display:none; }
}
/* === –ñ–Å–°–¢–ö–ò–ï –°–ë–†–û–°–´ –î–õ–Ø –õ–ò–î–ï–†–ë–û–†–î–ê, —á—Ç–æ–±—ã –Ω–µ –ø—Ä—è—Ç–∞–ª–∏—Å—å —Å—Ç—Ä–æ–∫–∏ === */
#records-classic .lb-list,
#records-one .lb-list {
  display: block !important;
  max-height: none !important;
  overflow: visible !important;
}

#records-classic .lb-row,
#records-one .lb-row {
  display: grid !important;             /* –∏–º–µ–Ω–Ω–æ grid, –Ω–µ table-row */
  visibility: visible !important;
  opacity: 1 !important;
}

#records-classic .lb-row + .lb-row,
#records-one   .lb-row + .lb-row {
  /* –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ —Å–æ—Å–µ–¥–Ω–∏–µ —Å—Ç—Ä–æ–∫–∏ –Ω–µ —Å–∫—Ä—ã–≤–∞—é—Ç—Å—è –Ω–∏–∫–∞–∫–∏–º–∏ :not(:first-child) —Ö–∞–∫–∞–º–∏ */
  display: grid !important;
}

/* –ù–∞ –≤—Å—è–∫–∏–π –ø–æ–∂–∞—Ä–Ω—ã–π: –Ω–∏—á–µ–≥–æ –Ω–µ –¥–æ–ª–∂–Ω–æ –≤—ã—Å—Ç–∞–≤–ª—è—Ç—å –¥–µ—Ç—è–º display:none */
#records-classic .lb-row *,
#records-one .lb-row * {
  display: block;
}
#records-classic .lb-row .lb-cell,
#records-one .lb-row .lb-cell {
  /* grid –æ—Å—Ç–∞—ë—Ç—Å—è —É .lb-row, –∞ —è—á–µ–π–∫–∏ ‚Äî –±–ª–æ–∫–∏ —Å –ø–µ—Ä–µ–Ω–æ—Å–æ–º –ø–æ —Å–µ—Ç–∫–µ */
  display: block !important;
}
/* ===== –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –∫–∞–∫ —Å–ø–∏—Å–æ–∫: –Ω–∏—á–µ–≥–æ –Ω–µ —Å–∫—Ä—ã–≤–∞–µ–º –∏ –Ω–µ —Å–∂–∏–º–∞–µ–º ===== */
.lb-ol {
  list-style: decimal inside;
  margin: 8px 0 0 0;
  padding: 0;
  max-height: none !important;
  overflow: visible !important;
}
.lb-ol > li {
  display: block !important;
  visibility: visible !important;
  opacity: 1 !important;
  padding: 6px 8px;
  border-bottom: 1px solid rgba(255,255,255,.15);
  white-space: nowrap;
  text-overflow: ellipsis;
  overflow: hidden;
}
.lb-ol > li.head {
  font-weight: 700;
  background: rgba(255,255,255,.06);
  border-radius: 6px;
  list-style: none;
}
.lb-ol > li .name { margin-left: 6px; }
.lb-ol > li .score { font-weight: 700; margin-left: 10px; }
.lb-ol > li .date { opacity: .85; margin-left: 12px; font-size: .95em; }
  </style>
</head>
<body>
  <div id="toast"></div>

  <div id="name-modal">
    <div class="card">
      <h2>–í–≤–µ–¥–∏—Ç–µ –∏–º—è</h2>
      <input type="text" id="player-name" placeholder="–í–∞—à–µ –∏–º—è">
      <br><br>
      <button onclick="startGameWithName()" class="btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
    </div>
  </div>

  <div class="container">
    <h1>–Ø–¥–∑–∏ (Yahtzee) Web</h1>

    <div class="tabs">
      <button class="tab-btn active" data-tab="game"      onclick="showTab('game')">–ö–ª–∞—Å—Å–∏–∫–∞</button>
      <button class="tab-btn"         data-tab="one-round" onclick="showTab('one-round')">1 —Ä–∞—É–Ω–¥</button>
      <button class="tab-btn"         data-tab="records"   onclick="showTab('records')">–†–µ–∫–æ—Ä–¥—ã</button>
      <button class="tab-btn"         data-tab="rules"     onclick="showTab('rules')">–ü—Ä–∞–≤–∏–ª–∞</button>
    </div>

    <div class="top-actions">
      <button id="save-btn" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç</button>
      <button id="reset-btn" class="btn">üîÑ –ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>

    <!-- ===== –ö–ª–∞—Å—Å–∏–∫–∞ (3 —Ä–∞—É–Ω–¥–∞) ===== -->
    <div id="game" class="tab-content active">
      <div class="turn-panel js-round-info"></div>
      <div class="dice-row js-dice-row"></div>
      <div style="text-align:center">
        <button class="btn js-roll-btn">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏</button>
        <div class="hide finish js-final"></div>
        <span class="js-rolls-info" style="margin-left:18px;"></span>
      </div>
      <div class="msg js-possible-moves"></div>
      <table class="score-table js-score-table"></table>
      <div class="msg js-game-msg"></div>
    </div>

    <!-- ===== 1 —Ä–∞—É–Ω–¥ (1 —Ä–∞—É–Ω–¥ = —Å—Ä–∞–∑—É —Ñ–∏–Ω–∞–ª) ===== -->
    <div id="one-round" class="tab-content">
      <div class="turn-panel js-round-info"></div>
      <div class="dice-row js-dice-row"></div>
      <div style="text-align:center">
        <button class="btn js-roll-btn">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏</button>
        <div class="hide finish js-final"></div>
        <span class="js-rolls-info" style="margin-left:18px;"></span>
      </div>
      <div class="msg js-possible-moves"></div>
      <table class="score-table js-score-table"></table>
      <div class="msg js-game-msg"></div>
    </div>

   <div id="records" class="tab-content">
  <h2 style="color:#2980b9;text-align:center;">üèÜ –†–µ–∫–æ—Ä–¥—ã –∏–≥—Ä–æ–∫–æ–≤</h2>
  <div style="display:flex;gap:20px;justify-content:center;flex-wrap:wrap;">
    <div style="flex:1;min-width:320px;">
      <h3 style="text-align:center;">–ö–ª–∞—Å—Å–∏–∫–∞</h3>
      <div id="records-classic" class="msg">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
    <div style="flex:1;min-width:320px;">
      <h3 style="text-align:center;">1 —Ä–∞—É–Ω–¥</h3>
      <div id="records-one" class="msg">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    </div>
  </div>
</div>


    <!-- –æ—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç ¬´–ü—Ä–∞–≤–∏–ª–∞¬ª –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->

  <div id="rules" class="tab-content">
    <div class="rules-box">
      <h2>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
      <p><b>üéØ –¶–µ–ª—å –∏–≥—Ä—ã</b><br>
      –ù–∞–±—Ä–∞—Ç—å –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –æ—á–∫–æ–≤, –∑–∞–ø–æ–ª–Ω—è—è —Ç–∞–±–ª–∏—Ü—É –∫–æ–º–±–∏–Ω–∞—Ü–∏–π –∑–∞ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞—É–Ω–¥–æ–≤.</p>

      <p><b>üïπ –•–æ–¥ –∏–≥—Ä–æ–∫–∞</b><br>
      1. –ó–∞ —Ö–æ–¥ –¥–∞—ë—Ç—Å—è –¥–æ <b>—Ç—Ä—ë—Ö –±—Ä–æ—Å–∫–æ–≤</b> –ø—è—Ç–∏ –∫—É–±–∏–∫–æ–≤.<br>
      2. –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∏ –≤—Ç–æ—Ä–æ–≥–æ –±—Ä–æ—Å–∫–∞ –º–æ–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å, –∫–∞–∫–∏–µ –∫—É–±–∏–∫–∏ –æ—Å—Ç–∞–≤–∏—Ç—å (¬´–∑–∞–º–æ—Ä–æ–∑–∏—Ç—å¬ª), –∞ –∫–∞–∫–∏–µ –ø–µ—Ä–µ–±—Ä–æ—Å–∏—Ç—å.<br>
      3. –ü–æ—Å–ª–µ —Ç—Ä–µ—Ç—å–µ–≥–æ –±—Ä–æ—Å–∫–∞ (–∏–ª–∏ —Ä–∞–Ω—å—à–µ –ø–æ –∂–µ–ª–∞–Ω–∏—é) –Ω—É–∂–Ω–æ –≤—ã–±—Ä–∞—Ç—å —Å–≤–æ–±–æ–¥–Ω–æ–µ –ø–æ–ª–µ –≤ —Ç–∞–±–ª–∏—Ü–µ –∏ –∑–∞–ø–∏—Å–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.<br>
      4. –ï—Å–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏—è –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞, –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–µ –ø–æ–ª–µ —Å—Ç–∞–≤–∏—Ç—Å—è <b>0</b>.</p>

      <p><b>üìä –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫</b><br>
      ‚Ä¢ <b>–ï–¥–∏–Ω–∏—Ü—ã ‚Äì –®–µ—Å—Ç—ë—Ä–∫–∏</b> ‚Äî –≤ –ø–æ–ª–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å—É–º–º–∞ –≤—Å–µ—Ö –∫—É–±–∏–∫–æ–≤ —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º —á–∏—Å–ª–æ–º.<br>
      ‚Ä¢ <b>–ë–æ–Ω—É—Å +35 –æ—á–∫–æ–≤</b> ‚Äî –¥–∞—ë—Ç—Å—è, –µ—Å–ª–∏ —Å—É–º–º–∞ –æ—á–∫–æ–≤ –≤ –≤–µ—Ä—Ö–Ω–µ–º –±–ª–æ–∫–µ ‚â• 63.</p>

      <p><b>üìä –ù–∏–∂–Ω–∏–π –±–ª–æ–∫</b><br>
      ‚Ä¢ <b>–ü–∞—Ä–∞</b> ‚Äî —Ö–æ—Ç—è –±—ã –¥–≤–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö. –û—á–∫–∏: —Å—É–º–º–∞ –≤—Å–µ—Ö –∫—É–±–∏–∫–æ–≤.<br>
      ‚Ä¢ <b>–î–≤–µ –ø–∞—Ä—ã</b> ‚Äî –¥–≤–µ —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä—ã, –∏–ª–∏ –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç –¥–≤–µ –ø–∞—Ä—ã (–∫–∞—Ä–µ –∏–ª–∏ –Ø–¥–∑–∏). –û—á–∫–∏: —Å—É–º–º–∞ –≤—Å–µ—Ö –∫—É–±–∏–∫–æ–≤.<br>
      ‚Ä¢ <b>–°–µ—Ç (—Ç—Ä–æ–π–∫–∞)</b> ‚Äî —Ç—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö. –û—á–∫–∏: —Å—É–º–º–∞ –≤—Å–µ—Ö –∫—É–±–∏–∫–æ–≤.<br>
      ‚Ä¢ <b>–ö–∞—Ä–µ (—á–µ—Ç–≤—ë—Ä–∫–∞)</b> ‚Äî —á–µ—Ç—ã—Ä–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö. –û—á–∫–∏: —Å—É–º–º–∞ –≤—Å–µ—Ö –∫—É–±–∏–∫–æ–≤.<br>
      ‚Ä¢ <b>–§—É–ª–ª-—Ö–∞—É—Å</b> ‚Äî —Ç—Ä–æ–π–∫–∞ + –ø–∞—Ä–∞. –û—á–∫–∏: 25.<br>
      ‚Ä¢ <b>–ú–∞–ª—ã–π —Å—Ç—Ä–∏—Ç</b> ‚Äî —á–µ—Ç—ã—Ä–µ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–ª–∞ (1-2-3-4, 2-3-4-5, 3-4-5-6). –û—á–∫–∏: 30.<br>
      ‚Ä¢ <b>–ë–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç</b> ‚Äî –ø—è—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª (1-2-3-4-5 –∏–ª–∏ 2-3-4-5-6). –û—á–∫–∏: 40.<br>
      ‚Ä¢ <b>–Ø–¥–∑–∏</b> ‚Äî –ø—è—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö. –û—á–∫–∏: 50.<br>
      ‚Ä¢ <b>–®–∞–Ω—Å</b> ‚Äî –ª—é–±—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è. –û—á–∫–∏: —Å—É–º–º–∞ –≤—Å–µ—Ö –∫—É–±–∏–∫–æ–≤.</p>

      <p><b>üèÜ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø–∞—Ä—Ç–∏–∏</b><br>
      ‚Ä¢ –ü–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π —Å—É–º–º–∏—Ä—É—é—Ç—Å—è –æ—á–∫–∏ –≤–µ—Ä—Ö–Ω–µ–≥–æ –∏ –Ω–∏–∂–Ω–µ–≥–æ –±–ª–æ–∫–æ–≤.<br>
      ‚Ä¢ –í —Ä–µ–∂–∏–º–µ <b>1 —Ä–∞—É–Ω–¥</b> —Ñ–∏–Ω–∞–ª –Ω–∞—Å—Ç—É–ø–∞–µ—Ç —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö –ø–æ–ª–µ–π –æ–¥–Ω–æ–≥–æ —Ä–∞—É–Ω–¥–∞.<br>
      ‚Ä¢ –ü–æ–±–µ–∂–¥–∞–µ—Ç –∏–≥—Ä–æ–∫ —Å –Ω–∞–∏–±–æ–ª—å—à–µ–π —Å—É–º–º–æ–π.</p>

      <div style="margin-top:20px; text-align:center;">
        <p><b>–ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ–∫–∞–∑–∞–ª–∏—Å—å —Å–ª–æ–∂–Ω—ã–º–∏ –∏–ª–∏ –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã —á—Ç–æ-—Ç–æ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ ‚Äî –ø—Ä–µ–¥–ª–∞–≥–∞—é –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–º–µ—Ä –ø–∞—Ä—Ç–∏–∏:</b></p>
      </div>

      <!-- –í–∏–¥–µ–æ -->
      <div style="margin-top:20px; position:relative; padding-bottom:56.25%; height:0; overflow:hidden;">
        <iframe src="https://vkvideo.ru/video_ext.php?oid=-203677279&id=456241703&hash=304a57eca49b6a00"
                style="position:absolute; top:0; left:0; width:100%; height:100%;"
                frameborder="0" allowfullscreen="1"
                allow="autoplay; encrypted-media; fullscreen; picture-in-picture">
        </iframe>
      </div>
    </div>
  </div>

  <!-- Firebase compat SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <script>
  // --- Tabs ---
  let activeGame = null;
  function showTab(tab) {
    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
    document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));

    const panel = document.getElementById(tab);
    if (panel) panel.classList.add('active');

    const btn = document.querySelector(`.tab-btn[data-tab="${tab}"]`);
    if (btn) btn.classList.add('active');

    if (tab === 'records' && typeof ensureLeaderboardSubscribed === 'function') {
      ensureLeaderboardSubscribed();
    }

    if (tab === 'game') {
      activeGame = classicGame;
      // –ê–≤—Ç–æ—Å—Ç–∞—Ä—Ç, –µ—Å–ª–∏ –∏–º—è —É–∂–µ –µ—Å—Ç—å –∏ —Ä–∞—É–Ω–¥ –µ—â—ë –Ω–µ –Ω–∞—á–∞—Ç
      if (playerName && !classicGame.started) classicGame.startRound();
    } else if (tab === 'one-round') {
      activeGame = oneRoundGame;
      if (playerName && !oneRoundGame.started) oneRoundGame.startRound();
    }
  }

  // ---------- –û–±—â–∏–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∏ —É—Ç–∏–ª–∏—Ç—ã ----------
  const upperFields = ["1", "2", "3", "4", "5", "6"];
  const lowerFields = ["–ü–∞—Ä–∞","–î–≤–µ –ø–∞—Ä—ã","–°–µ—Ç","–ö–∞—Ä–µ","–§—É–ª–ª —Ö–∞—É—Å","–ú–∞–ª—ã–π —Å—Ç—Ä–∏—Ç","–ë–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç","–Ø–¥–∑–∏","–®–∞–Ω—Å"];
  const allFields = [...upperFields, ...lowerFields];

  function randomDice(){ return Math.floor(Math.random()*6)+1; }
  function diceEmoji(v){ return ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'][v-1]; }
  function countDice(a){ const c={1:0,2:0,3:0,4:0,5:0,6:0}; for(const d of a) c[d]++; return c; }

  function possibleScores(dice, table) {
    const d = countDice(dice);
    const res = {};

    // –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫
    for (const f of upperFields) {
      if (table[f] === null) res[f] = d[+f] * (+f);
    }

    // –ü–∞—Ä–∞
    if (table["–ü–∞—Ä–∞"] === null) {
      res["–ü–∞—Ä–∞"] = 0;
      for (let i = 6; i >= 1; i--) {
        if (d[i] >= 2) { res["–ü–∞—Ä–∞"] = dice.reduce((a,b)=>a+b,0); break; }
      }
    }

    // –î–≤–µ –ø–∞—Ä—ã ‚Äî –∫–∞—Ä–µ/–Ø–¥–∑–∏ —Ç–æ–∂–µ —Å—á–∏—Ç–∞–µ–º –∫–∞–∫ –¥–≤–µ –ø–∞—Ä—ã
    if (table["–î–≤–µ –ø–∞—Ä—ã"] === null) {
      const pairCount = Object.values(d).reduce((sum, c) => sum + Math.floor(c / 2), 0);
      res["–î–≤–µ –ø–∞—Ä—ã"] = pairCount >= 2 ? dice.reduce((a,b)=>a+b,0) : 0;
    }

    // –°–µ—Ç
    if (table["–°–µ—Ç"] === null) {
      res["–°–µ—Ç"] = 0;
      for (let i = 6; i >= 1; i--) {
        if (d[i] >= 3) { res["–°–µ—Ç"] = dice.reduce((a,b)=>a+b,0); break; }
      }
    }

    // –ö–∞—Ä–µ
    if (table["–ö–∞—Ä–µ"] === null) {
      res["–ö–∞—Ä–µ"] = 0;
      for (let i = 6; i >= 1; i--) {
        if (d[i] >= 4) { res["–ö–∞—Ä–µ"] = dice.reduce((a,b)=>a+b,0); break; }
      }
    }

    // –§—É–ª–ª —Ö–∞—É—Å
    if (table["–§—É–ª–ª —Ö–∞—É—Å"] === null) {
      let has3 = false, has2 = false;
      for (let i = 1; i <= 6; i++) {
        if (d[i] === 3) has3 = true;
        else if (d[i] === 2) has2 = true;
      }
      res["–§—É–ª–ª —Ö–∞—É—Å"] = (has3 && has2) ? 25 : 0;
    }

    // –ú–∞–ª—ã–π —Å—Ç—Ä–∏—Ç
    if (table["–ú–∞–ª—ã–π —Å—Ç—Ä–∏—Ç"] === null) {
      const u = [...new Set(dice)].sort((a,b)=>a-b);
      const has = [[1,2,3,4],[2,3,4,5],[3,4,5,6]].some(seq => seq.every(x => u.includes(x)));
      res["–ú–∞–ª—ã–π —Å—Ç—Ä–∏—Ç"] = has ? 30 : 0;
    }

    // –ë–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç
    if (table["–ë–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç"] === null) {
      const has = [1,2,3,4,5].every(x => dice.includes(x)) ||
                  [2,3,4,5,6].every(x => dice.includes(x));
      res["–ë–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç"] = has ? 40 : 0;
    }

    // –Ø–¥–∑–∏
    if (table["–Ø–¥–∑–∏"] === null) {
      res["–Ø–¥–∑–∏"] = Object.values(d).includes(5) ? 50 : 0;
    }

    // –®–∞–Ω—Å
    if (table["–®–∞–Ω—Å"] === null) {
      res["–®–∞–Ω—Å"] = dice.reduce((a,b)=>a+b,0);
    }

    return res;
  }

  // ---------- –ö–ª–∞—Å—Å –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞ –æ–¥–Ω–æ–π –∏–≥—Ä—ã ----------
  function GameController(rootEl, roundsCount) {
    this.root = rootEl;            // –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∫–ª–∞–¥–∫–∏
    this.roundsCount = roundsCount; // 3 (–∫–ª–∞—Å—Å–∏–∫–∞) –∏–ª–∏ 1 (–æ–¥–∏–Ω —Ä–∞—É–Ω–¥)

    this.round = 1;
    this.rollsLeft = 3;
    this.dice = [1,1,1,1,1];
    this.diceKeep = [false,false,false,false,false];
    this.roundScoreTables = Array.from({length: this.roundsCount}, () => ({}));
    this.scoreTable = {};
    this.started = false;

    this.resetScoreTable = () => { this.scoreTable = {}; for (const f of allFields) this.scoreTable[f]=null; };

    // –≠–ª–µ–º–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –≤–∫–ª–∞–¥–∫–∏
    this.elRoundInfo = this.root.querySelector('.js-round-info');
    this.elDiceRow   = this.root.querySelector('.js-dice-row');
    this.elRollBtn   = this.root.querySelector('.js-roll-btn');
    this.elFinal     = this.root.querySelector('.js-final');
    this.elRollsInfo = this.root.querySelector('.js-rolls-info');
    this.elMoves     = this.root.querySelector('.js-possible-moves');
    this.elTable     = this.root.querySelector('.js-score-table');
    this.elMsg       = this.root.querySelector('.js-game-msg');

    this.drawDiceRow = () => {
      this.elDiceRow.innerHTML = '';
      for (let i=0;i<5;i++){
        const d = document.createElement('div');
        d.className = 'dice' + (this.diceKeep[i] ? ' selected' : '');
        d.innerHTML = diceEmoji(this.dice[i]);
        d.onclick = () => {
          if (this.rollsLeft<3 && this.rollsLeft>0) {
            this.diceKeep[i] = !this.diceKeep[i];
            this.drawDiceRow();
          }
        };
        this.elDiceRow.appendChild(d);
      }
    };

    this.animateRoll = (cb) => {
      let t=10;
      const int=setInterval(()=>{
        for (let i=0;i<5;i++) if(!this.diceKeep[i]) this.dice[i]=randomDice();
        this.drawDiceRow();
        if(--t==0){ clearInterval(int); cb&&cb(); }
      },60);
    };

    this.showPossibleMoves = (poss) => {
      const arr = Object.entries(poss).filter(([k])=>this.scoreTable[k]===null);
      if (!arr.length) { this.elMoves.innerHTML=''; return; }
      const chips = arr.map(([k,v]) =>
        '<button class="chip" onclick="window.__choose(\''+k+'\')">'+k+' <span class="chip-score">('+v+')</span></button>'
      ).join('');
      this.elMoves.innerHTML = '<div class="chips-title">–í—ã–±–µ—Ä–∏ –∫—É–¥–∞ –∑–∞–ø–∏—Å–∞—Ç—å:</div><div class="chips">'+chips+'</div>';
    };
    this.hidePossibleMoves = () => { this.elMoves.innerHTML = ''; };

    this.chooseField = (field) => {
      const poss = possibleScores(this.dice, this.scoreTable);
      if (this.scoreTable[field]!==null) return;
      this.scoreTable[field] = poss[field];
      this.roundScoreTables[this.round-1][field] = poss[field];

      this.drawTable();
      this.hidePossibleMoves();

      const finished = allFields.every(f => this.scoreTable[f]!==null);
      this.rollsLeft = 3;
      this.diceKeep = [false,false,false,false,false];
      this.elRollBtn.disabled = false;
      this.elRollsInfo.innerHTML = "";
      this.elMsg.innerHTML = "";
      this.drawDiceRow();

      if (finished) {
        this.elMsg.innerHTML = `<b>–†–∞—É–Ω–¥ ${this.round} –∑–∞–≤–µ—Ä—à—ë–Ω!</b>`;
        setTimeout(()=>{
          if (this.round < this.roundsCount) { this.round++; this.startRound(); }
          else { this.showFinal(); }
        }, 1200);
      }
    };

    this.drawTable = () => {
      // –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —Ä–∞—É–Ω–¥–æ–≤
      let html = '<tr><th>–ü–æ–ª–µ</th>';
      for (let r=1; r<=this.roundsCount; r++) html += `<th>–†–∞—É–Ω–¥ ${r}</th>`;
      html += '</tr>';

      html += `<tr><th colspan="${1+this.roundsCount}">–í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫</th></tr>`;

      const upperSums = Array.from({length: this.roundsCount}, () => 0);

      for (const f of upperFields) {
        html += `<tr><td>${f}</td>`;
        for (let r=0;r<this.roundsCount;r++){
          const v = this.roundScoreTables[r][f] ?? "";
          if (v !== "") upperSums[r] += v;
          html += `<td${r+1===this.round?' style="background:#2ecc4022;"':''}>${v}</td>`;
        }
        html += `</tr>`;

        if (f === '6') {
          // –°—É–º–º–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞
          html += '<tr><td><b>–°—É–º–º–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞</b></td>' +
            upperSums.map((s)=>`<td class="${s >= 63 ? 'upper-bonus' : ''}"><b>${s}</b></td>`).join('') +
            '</tr>';

          // –ë–æ–Ω—É—Å—ã
          html += '<tr><td><b>–ë–æ–Ω—É—Å (+35, –µ—Å–ª–∏ ‚â•63)</b></td>' +
            upperSums.map((s)=>`<td class="bonus">${s >= 63 ? 35 : ''}</td>`).join('') +
            '</tr>';

          // –°—É–º–º–∞ –Ω–∏–∂–Ω–µ–≥–æ –±–ª–æ–∫–∞
          const lower = Array.from({length:this.roundsCount}, ()=>0);
          for (let r=0;r<this.roundsCount;r++)
            for (const ff of lowerFields)
              lower[r] += (this.roundScoreTables[r][ff] ?? 0);

          html += '<tr><td><b>–°—É–º–º–∞ –Ω–∏–∂–Ω–µ–≥–æ –±–ª–æ–∫–∞</b></td>' +
            lower.map((s)=>`<td><b>${s}</b></td>`).join('') +
            '</tr>';
        }
      }

      html += `<tr><th colspan="${1+this.roundsCount}">–ù–∏–∂–Ω–∏–π –±–ª–æ–∫</th></tr>`;
      for (const f of lowerFields) {
        html += `<tr><td>${f}</td>`;
        for (let r=0;r<this.roundsCount;r++){
          const v = this.roundScoreTables[r][f] ?? "";
          html += `<td${r+1===this.round?' style=\"background:#2ecc4022;\"':''}>${v}</td>`;
        }
        html += `</tr>`;
      }

      // –ò—Ç–æ–≥–æ —Ä–∞—É–Ω–¥—ã
      html += `<tr><td><b>–ò—Ç–æ–≥–æ –∑–∞ —Ä–∞—É–Ω–¥</b></td>`;
      const roundTotals = [];
      for (let r=0;r<this.roundsCount;r++){
        let s=0;
        for (const f of allFields) s += (this.roundScoreTables[r][f] || 0);
        if (upperSums[r] >= 63) s += 35;
        roundTotals[r] = s;
        html += `<td><b>${s || ""}</b></td>`;
      }
      html += `</tr>`;

      const totalAll = roundTotals.reduce((a,b)=>a+b,0);
const bestNow = (this.roundsCount === 1) ? bestOne : bestClassic;
const remain = Math.max(bestNow - totalAll, 0);
let extra = '';
if (bestNow > 0) {
  extra = remain > 0
    ? `<div style="font-weight:normal;font-size:0.95em;color:#2980b9;margin-top:6px;">–û—Å—Ç–∞–ª–æ—Å—å –¥–æ —Ä–µ–∫–æ—Ä–¥–∞: <b>${remain}</b> (—Ä–µ–∫–æ—Ä–¥: ${bestNow})</div>`
    : (totalAll > 0
        ? `<div style="font-weight:normal;font-size:0.95em;color:#27ae60;margin-top:6px;">–≠—Ç–æ <b>—Ä–µ–∫–æ—Ä–¥!</b> (—Å—Ç–∞—Ä—ã–π: ${bestNow})</div>`
        : '');
}
      html += `<tr>
        <td><b>–°—É–º–º–∞ –≤—Å–µ–≥–æ</b></td>
        <td colspan="${this.roundsCount}"><b>${totalAll}</b>${extra}</td>
      </tr>`;

      this.elTable.innerHTML = html;
    };

    this.startRound = () => {
      this.started = true;
      this.resetScoreTable();
      this.rollsLeft = 3;
      this.dice = [1,1,1,1,1];
      this.diceKeep = [false,false,false,false,false];

      this.elFinal.classList.add('hide');
      this.elRoundInfo.innerHTML = this.roundsCount === 1
  ? '<b>–†–µ–∂–∏–º: 1 —Ä–∞—É–Ω–¥</b> ¬∑ <span style="font-weight:normal">–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –æ—Ç 250+</span>'
  : `<b>–†–∞—É–Ω–¥ ${this.round} –∏–∑ ${this.roundsCount}</b>`;
      this.elMsg.innerHTML = "";
      this.drawDiceRow();
      this.drawTable();
      this.hidePossibleMoves();
      this.elRollBtn.disabled = false;
      this.elRollsInfo.innerHTML = '–ë—Ä–æ—Å–∫–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å: <b>3</b>';
    };

    this.getCurrentTotal = () => {
      const upper = Array.from({length: this.roundsCount}, ()=>0);
      for (let r=0;r<this.roundsCount;r++) for (const f of upperFields) upper[r]+=this.roundScoreTables[r][f]??0;
      const totals=[];
      for (let r=0;r<this.roundsCount;r++){
        let s=0;
        for (const f of allFields) s+=this.roundScoreTables[r][f]||0;
        if (upper[r]>=63) s+=35;
        totals[r]=s;
      }
      return totals.reduce((a,b)=>a+b,0);
    };

    this.showFinal = () => {
  const total = this.getCurrentTotal();
  const isOne = (this.roundsCount === 1);
  const min = isOne ? 250 : 777;

  let message = "";
  if (total >= min) {
    if (isOne) {
      // –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ: –ø—Ä–æ—Å—Ç–æ–µ –ø–æ–∑–¥—Ä–∞–≤–ª–µ–Ω–∏–µ + –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å
      message = `üéâ <b>–û, –∫–ª–∞—Å—Å–Ω–æ, —Ç—ã –ø–æ–±–µ–¥–∏–ª!</b><br>–¢—ã –Ω–∞–±—Ä–∞–ª <b>${total}</b> –æ—á–∫–æ–≤.<br><br><b>–ù–µ –∑–∞–±—É–¥—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç.</b>`;
    } else {
      // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–≤–æ—é "—Ñ–∏—Ä–º–µ–Ω–Ω—É—é" –ø–æ–¥–∞—á—É –¥–ª—è –∫–ª–∞—Å—Å–∏–∫–∏
      message = `üéâ <b>–ü–æ–∑–¥—Ä–∞–≤–ª—è–µ–º!</b> üéâ<br>–¢—ã –Ω–∞–±—Ä–∞–ª <b>${total}</b> –æ—á–∫–æ–≤.`;
      if (total > 1030) {
        message += `<br>üëë –¢—ã –≤ <b>–ø—Ä–∞–π–º–µ</b>! –ï—â—ë —á—É—Ç—å-—á—É—Ç—å ‚Äî –∏ —Ç—ã –æ–±–≥–æ–Ω–∏—à—å –õ–µ–Ω—É! üî•`;
      } else if (total > 950) {
        message += `<br>üî• –î–∞ —Ç—ã –Ω–∞—Å—Ç–æ—è—â–∏–π <b>–∑–∞–¥—Ä–æ—Ç</b> ‚Äî —Å—Ç–æ–ª—å–∫–æ –±–∞–ª–ª–æ–≤! –í–∞—É! üî•`;
      }
      message += `<br><br><b>–ù–µ –∑–∞–±—É–¥—å –Ω–∞–∂–∞—Ç—å ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç¬ª (–∫–Ω–æ–ø–∫–∞ –≤–≤–µ—Ä—Ö—É).</b>`;
    }
  } else {
    if (isOne) {
      message = `üò¢ <b>–£–ø—Å!</b> –¢—ã –Ω–∞–±—Ä–∞–ª <b>${total}</b> –æ—á–∫–æ–≤.<br>–ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º <b>250</b> –æ—á–∫–æ–≤ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è.<br>–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!`;
    } else {
      message = `üò¢ <b>–£–≤—ã!</b> –¢—ã –Ω–∞–±—Ä–∞–ª <b>${total}</b> –æ—á–∫–æ–≤.<br>–ß—Ç–æ–±—ã —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç, –Ω—É–∂–Ω–æ –Ω–∞–±—Ä–∞—Ç—å –º–∏–Ω–∏–º—É–º <b>777</b> –æ—á–∫–æ–≤.<br>–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –æ—Ç 777 –∏ –≤—ã—à–µ.`;
    }
  }

  this.elFinal.classList.remove('hide');
  this.elFinal.innerHTML = `
    <div>
      ${message}
      <br><br>
      <button class="btn" onclick="window.__restart()">–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button>
    </div>
  `;

  ensureLeaderboardSubscribed();
};

    this.restartGame = () => { this.round=1; this.roundScoreTables=Array.from({length:this.roundsCount},()=>({})); this.startRound(); };

    // –±—Ä–æ—Å–∫–∏
    this.elRollBtn.onclick = () => {
      if (this.rollsLeft>0){
        this.elRollBtn.disabled = true;
        this.animateRoll(()=>{
          this.rollsLeft--;
          this.elRollBtn.disabled = (this.rollsLeft==0);
          this.elRollsInfo.innerHTML = `–ë—Ä–æ—Å–∫–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å: <b>${this.rollsLeft}</b>`;
          if (this.rollsLeft==0){
            this.showPossibleMoves(possibleScores(this.dice, this.scoreTable));
            this.elMsg.innerHTML = '–í—ã–±–µ—Ä–∏ –ø–æ–ª–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.';
          } else {
            this.elMsg.innerHTML = '–í—ã–¥–µ–ª–∏ –∫—É–±–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ö–æ—á–µ—à—å –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞—Ç—å, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –±—Ä–æ—Å–∞–π.';
          }
        });
      }
    };
  }

  // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–æ–º–æ—â–Ω–∏–∫–∏ –¥–ª—è inline onclick
  window.__choose = (field) => {
    if (activeGame) activeGame.chooseField(field);
  };
  window.__restart = () => {
    if (activeGame) activeGame.restartGame();
  };

  // ---------- –ò–º—è –∏–≥—Ä–æ–∫–∞ ----------
  let playerName = "";
  function startGameWithName(){
    const v = document.getElementById('player-name').value.trim();
    if (!v) { alert('–í–≤–µ–¥–∏—Ç–µ –∏–º—è!'); return; }
    playerName = v;
    document.getElementById('name-modal').style.display='none';
    // –°—Ç–∞—Ä—Ç—É–µ–º –∏–≥—Ä—É –≤–æ –≤–∫–ª–∞–¥–∫–µ, –∫–æ—Ç–æ—Ä–∞—è –∞–∫—Ç–∏–≤–Ω–∞ —Å–µ–π—á–∞—Å
    if (!activeGame.started) activeGame.startRound();
  }
  window.startGameWithName = startGameWithName;

  // ---------- Firebase setup (compat) ----------
  const firebaseConfig = {
    apiKey: "AIzaSyDJX6EdXi_24H80N0WPfdHjmMZ97xRjuQQ",
    authDomain: "yadzee-a6b2b.firebaseapp.com",
    databaseURL: "https://yadzee-a6b2b-default-rtdb.europe-west1.firebasedatabase.app",
    projectId: "yadzee-a6b2b",
    storageBucket: "yadzee-a6b2b.appspot.com",
    messagingSenderId: "67079856385",
    appId: "1:67079856385:web:cbc043ecfa6081b9983b00",
    measurementId: "G-G3HHBM8BF1"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // --- –†–µ–∫–æ—Ä–¥ (–¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ "–æ—Å—Ç–∞–ª–æ—Å—å –¥–æ —Ä–µ–∫–æ—Ä–¥–∞") ---
  // --- –õ—É—á—à–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ —Ä–µ–∂–∏–º–∞–º (–¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏ "–æ—Å—Ç–∞–ª–æ—Å—å –¥–æ —Ä–µ–∫–æ—Ä–¥–∞") ---
let bestClassic = 0;
let bestOne = 0;

function subscribeBestScores() {
  // –ö–ª–∞—Å—Å–∏–∫–∞
  db.ref('scores').orderByChild('score').limitToLast(1).on('value', (snap)=>{
    let max = 0;
    snap && snap.forEach(ch => { const v = (ch.val().score|0); if (v > max) max = v; });
    bestClassic = max;
    if (classicGame?.elTable?.innerHTML) classicGame.drawTable();
  });

  // 1 —Ä–∞—É–Ω–¥
  db.ref('scores_one_round').orderByChild('score').limitToLast(1).on('value', (snap)=>{
    let max = 0;
    snap && snap.forEach(ch => { const v = (ch.val().score|0); if (v > max) max = v; });
    bestOne = max;
    if (oneRoundGame?.elTable?.innerHTML) oneRoundGame.drawTable();
  });
}
subscribeBestScores();

  // ---------- –¢–æ—Å—Ç—ã ----------
  function showToast(text){
    const t=document.getElementById('toast');
    t.textContent=text; t.style.display='block';
    setTimeout(()=>t.style.display='none',1800);
  }

  // ---------- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ ----------
async function saveScoreToFirebase(name, score, mode){
  const isOne = (mode === 'one');
  const min = isOne ? 250 : 777;
  const path = isOne ? 'scores_one_round' : 'scores';

  if ((score|0) < min) {
    showToast(`–í —ç—Ç–æ—Ç —Ä–µ–∂–∏–º —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –æ—Ç ${min} –æ—á–∫–æ–≤.`);
    return;
  }

  const payload = { name, score, mode, ts: Date.now() };
  try {
    await db.ref(path).push(payload);
    showToast('–†–µ–∑—É–ª—å—Ç–∞—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω!');
  } catch(e) {
    console.error('saveScore error', e);
    showToast('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å. –ü—Ä–æ–≤–µ—Ä—å —Å–µ—Ç—å –∏ –ø—Ä–∞–≤–∏–ª–∞ –ë–î.');
  }
}

  document.getElementById('save-btn').addEventListener('click', async ()=>{
    let name = playerName;
    if (!name) {
      name = prompt('–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏–≥—Ä–æ–∫–∞:');
      if (!name) return;
      playerName = name;
      document.getElementById('name-modal').style.display='none';
    }

    if (!activeGame) { showToast('–û—Ç–∫—Ä–æ–π –≤–∫–ª–∞–¥–∫—É —Å –∏–≥—Ä–æ–π.'); return; }

    const current = activeGame.getCurrentTotal();
    if (current <= 0) { showToast('–°–Ω–∞—á–∞–ª–∞ –Ω–∞–∏–≥—Ä–∞–π –æ—á–∫–∏ :)'); return; }
    const mode = (activeGame && activeGame.roundsCount === 1) ? 'one' : 'classic';
    await saveScoreToFirebase(name, current, mode);
  });

  // ---------- –ö–Ω–æ–ø–∫–∞ "–ù–æ–≤–∞—è –∏–≥—Ä–∞" ----------
  document.getElementById('reset-btn').addEventListener('click', () => {
    if (!activeGame) { showToast('–û—Ç–∫—Ä–æ–π –≤–∫–ª–∞–¥–∫—É —Å –∏–≥—Ä–æ–π.'); return; }
    if (!confirm('–ù–∞—á–∞—Ç—å –Ω–æ–≤—É—é –∏–≥—Ä—É? –¢–µ–∫—É—â–∏–π –ø—Ä–æ–≥—Ä–µ—Å—Å –±—É–¥–µ—Ç –ø–æ—Ç–µ—Ä—è–Ω.')) return;
    activeGame.restartGame();
  });

  // ---------- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ ----------
// ---------- –õ–∏–¥–µ—Ä–±–æ—Ä–¥ (–∂–µ–ª–µ–∑–æ–±–µ—Ç–æ–Ω–Ω—ã–π –≤—ã–≤–æ–¥ TOP-20) ----------
let scoresSubscribed = false;

function ensureLeaderboardSubscribed(){
  if (scoresSubscribed) return;
  scoresSubscribed = true;

  safeSubscribe('scores',            'records-classic');   // –ö–ª–∞—Å—Å–∏–∫–∞
  safeSubscribe('scores_one_round',  'records-one');       // 1 —Ä–∞—É–Ω–¥
}

function safeSubscribe(path, elId){
  const el = document.getElementById(elId);
  if (el) el.textContent = '–ó–∞–≥—Ä—É–∑–∫–∞...';

  const ref = firebase.database().ref(path);

  // 1) –û–¥–Ω–æ—Ä–∞–∑–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ (fallback) ‚Äî —Ä–∏—Å—É–µ–º —Å—Ä–∞–∑—É, –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è on()
  ref.once('value')
    .then(snap => {
      const rows = snap && snap.exists() ? normalizeRows(snap.val()) : [];
      renderLeaderboard(rows.slice(0, 20), elId);
    })
    .catch(err => {
      if (el) el.textContent = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: ' + (err?.message || err);
      console.error('once error for', path, err);
    });

  // 2) –ñ–∏–≤–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ ‚Äî –¥–∞–ª—å—à–µ –±—É–¥–µ—Ç –æ–±–Ω–æ–≤–ª—è—Ç—å —Å–ø–∏—Å–æ–∫
  ref.on('value', (snap) => {
    const rows = snap && snap.exists() ? normalizeRows(snap.val()) : [];
    renderLeaderboard(rows.slice(0, 20), elId);
  }, (err) => {
    if (el) el.textContent = '–û—à–∏–±–∫–∞ –ø–æ–¥–ø–∏—Å–∫–∏: ' + (err?.message || err);
    console.error('on error for', path, err);
  });
}

function normalizeRows(obj){
  // –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –≤–µ—Å—å —É–∑–µ–ª –≤ –º–∞—Å—Å–∏–≤, —Ñ–∏–ª—å—Ç—Ä—É–µ–º –º—É—Å–æ—Ä
  const rows = Object.values(obj || {}).filter(v => v && typeof v.score !== 'undefined');
  // –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: score ‚Üì, –ø—Ä–∏ —Ä–∞–≤–µ–Ω—Å—Ç–≤–µ ‚Äî ts ‚Üë (—Å—Ç–∞—Ä—à–∏–µ —Ä–∞–Ω—å—à–µ)
  rows.sort((a,b) => ( (b.score|0) - (a.score|0) ) || ( (a.ts||0) - (b.ts||0) ));
  return rows;
}

function renderLeaderboard(rows, elId){
  const wrap = document.getElementById(elId);
  if (!wrap) return;

  if (!rows || rows.length === 0){
    wrap.innerHTML = '–ï—â—ë –Ω–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –°—ã–≥—Ä–∞–π –ø–µ—Ä–≤—ã–º!';
    return;
  }

  let html = "<table class='score-table'><tr><th>–ú–µ—Å—Ç–æ</th><th>–ò–º—è</th><th>–û—á–∫–∏</th><th>–î–∞—Ç–∞</th></tr>";
  let prevScore = null, rank = 0, processed = 0;

  for (const r of rows){
    processed++;
    const score = (r.score|0);
    if (prevScore === null) rank = 1;
    else if (score !== (prevScore|0)) rank = processed;
    prevScore = score;

    const when = r.ts ? new Date(r.ts).toLocaleString() : '';
    html += `<tr>
      <td>${rank}</td>
      <td>${escapeHtml(r.name || '')}</td>
      <td>${score}</td>
      <td>${when}</td>
    </tr>`;
  }

  html += "</table>";
  wrap.innerHTML = html;
}

function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m =>
    ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])
  );
}

  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[m])); }

  // ---------- –°–æ–∑–¥–∞—ë–º –¥–≤–µ –∏–≥—Ä—ã ----------
  const classicGame = new GameController(document.getElementById('game'), 3);
  const oneRoundGame = new GameController(document.getElementById('one-round'), 1);
  // –ê–∫—Ç–∏–≤–Ω–æ–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é ‚Äî –∫–ª–∞—Å—Å–∏–∫–∞
  activeGame = classicGame;
  </script>
</body>
</html>
