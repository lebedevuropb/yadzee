<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–Ø–¥–∑–∏ (Yahtzee) - Web</title>
  <style>
    body { font-family: sans-serif; background: #2c3e50; color: #fff; margin: 0; padding: 0; }
    .container { max-width: 800px; margin: 0 auto; padding: 30px; }
    h1 { text-align: center; margin-bottom: 12px;}
    .tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 18px; }
    .tab-btn {
      background: #fff; color: #2980b9; border: none; padding: 10px 32px;
      border-radius: 7px 7px 0 0; cursor: pointer; font-size: 1.1em;
      border-bottom: 2px solid #eee; margin-bottom: -2px;
      transition: background 0.2s, color 0.2s;
    }
    .tab-btn.active { background: #2980b9; color: #fff; border-bottom: 2px solid #2980b9; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    .dice-row { display: flex; gap: 10px; justify-content: center; margin-bottom: 18px;}
    .dice { width: 60px; height: 60px; background: #fff; color: #222; border-radius: 14px; box-shadow: 0 2px 8px #0004; display: flex; align-items: center; justify-content: center; font-size: 2.7rem; cursor: pointer; border: 3px solid transparent; transition: border 0.2s;}
    .dice.selected { border: 3px solid #27ae60;}
    .score-table { margin: 16px auto; max-width: 600px; border-collapse: collapse;}
    .score-table th, .score-table td { border: 1px solid #666; padding: 7px 14px; text-align: center;}
    .score-table th { background: #34495e;}
    .score-table .available { cursor: pointer; background: #23aaff44;}
    .score-table .used { background: #424242;}
    .score-table .bonus { background: #39b54a99;}
    .btn { background: #2980b9; color: #fff; border: none; padding: 12px 32px; border-radius: 8px; cursor: pointer; font-size: 1.1rem; transition: background 0.2s;}
    .btn[disabled] { background: #666; cursor: not-allowed;}
    .turn-panel { text-align: center; margin: 13px 0 23px;}
    .msg { text-align: center; margin-bottom: 18px; font-size: 1.1rem;}
    .hide { display: none; }
    .finish { background: #3c990f; color: #fff; padding: 24px 12px; border-radius: 16px; text-align: center; font-size: 1.5rem; margin: 20px;}
    @media (max-width: 700px) {
      .container { padding: 6px; }
      .score-table { font-size: 0.95em;}
      .dice { width: 40px; height: 40px; font-size: 1.6em;}
      .tab-btn { padding: 8px 12px; font-size: 0.95em;}
    }
    /* –ö–ª–∞—Å—Å –¥–ª—è —Å—Å—ã–ª–∫–∏ –≤ –ø—Ä–∞–≤–∏–ª–∞—Ö */
    .rules-link { color: #2980b9; text-decoration: underline; cursor: pointer; }
  </style>
</head>
<body>

<div id="name-modal" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#000b;display:flex;align-items:center;justify-content:center;z-index:9999;">
  <div style="background:#fff;color:#000;padding:20px 30px;border-radius:12px;text-align:center;">
    <h2>–í–≤–µ–¥–∏—Ç–µ –∏–º—è</h2>
    <input type="text" id="player-name" placeholder="–í–∞—à–µ –∏–º—è" style="padding:10px;width:200px;">
    <br><br>
    <button onclick="startGameWithName()" class="btn">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</button>
  </div>
</div>

<style>
  #name-modal input { font-size: 1rem; }
  .score-table td { background: #fff; color: #000; }
</style>

  <div class="container">
    <h1>–Ø–¥–∑–∏ (Yahtzee) Web</h1>
    <div class="tabs">
      <button class="tab-btn active" onclick="showTab('game')">–ò–≥—Ä–∞</button>
      <button class="tab-btn" onclick="showTab('rules')">–ü—Ä–∞–≤–∏–ª–∞</button>
    </div>
    <div id="game" class="tab-content active">
      <div id="round-info" class="turn-panel"></div>
      <div id="dice-row" class="dice-row"></div>
      <div style="text-align:center">
        <button id="roll-btn" class="btn">–ë—Ä–æ—Å–∏—Ç—å –∫—É–±–∏–∫–∏</button>
        <span id="rolls-info" style="margin-left:18px;"></span>
      </div>
      <div id="possible-moves" class="msg"></div>
      <table class="score-table" id="score-table"></table>
      <div id="game-msg" class="msg"></div>
      <div id="final-block" class="hide finish"></div>
    </div>
    <div id="rules" class="tab-content">
      <h2 style="color:#2980b9;text-align:center;">–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã –Ø–¥–∑–∏</h2>
      <ul>
        <li><strong>–í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫:</strong> —Å–æ–±–µ—Ä–∏ –∫–∞–∫ –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö (–µ–¥–∏–Ω–∏—Ü, –¥–≤–æ–µ–∫... —à–µ—Å—Ç—ë—Ä–æ–∫). –í –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è —Å—É–º–º–∞ —Ç–æ–ª—å–∫–æ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —á–∏—Å–µ–ª. –ï—Å–ª–∏ –∑–∞ –≤–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫ —Å—É–º–º–∞—Ä–Ω–æ –Ω–∞–±—Ä–∞–Ω–æ <b>63 –∏ –±–æ–ª—å—à–µ</b> ‚Äî –±–æ–Ω—É—Å <b>+35</b> –æ—á–∫–æ–≤.</li>
        <li><strong>–ü–∞—Ä–∞:</strong> –ª—é–±–∞—è –ø–∞—Ä–∞ ‚Äî —Å—É–º–º–∞ –≤—Å–µ—Ö 5 –∫—É–±–∏–∫–æ–≤, –µ—Å–ª–∏ –µ—Å—Ç—å —Ö–æ—Ç—è –±—ã 2 –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö.</li>
        <li><strong>–î–≤–µ –ø–∞—Ä—ã:</strong> –ª—é–±—ã–µ –¥–≤–µ —Ä–∞–∑–Ω—ã–µ –ø–∞—Ä—ã ‚Äî —Å—É–º–º–∞ –≤—Å–µ—Ö 5 –∫—É–±–∏–∫–æ–≤.</li>
        <li><strong>–°–µ—Ç (—Ç—Ä–æ–π–∫–∞):</strong> —Ç—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö ‚Äî —Å—É–º–º–∞ –≤—Å–µ—Ö 5 –∫—É–±–∏–∫–æ–≤.</li>
        <li><strong>–ö–∞—Ä–µ:</strong> —á–µ—Ç—ã—Ä–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö ‚Äî —Å—É–º–º–∞ –≤—Å–µ—Ö 5 –∫—É–±–∏–∫–æ–≤.</li>
        <li><strong>–§—É–ª–ª —Ö–∞—É—Å:</strong> —Ç—Ä–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö –∏ –ø–∞—Ä–∞ ‚Äî 25 –æ—á–∫–æ–≤.</li>
        <li><strong>–ú–∞–ª—ã–π —Å—Ç—Ä–∏—Ç:</strong> –ª—é–±—ã–µ <u>—á–µ—Ç—ã—Ä–µ –ø–æ–¥—Ä—è–¥</u> –∑–Ω–∞—á–µ–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, <code>1-2-3-4</code>, <code>2-3-4-5</code>, <code>3-4-5-6</code> –≤ –ª—é–±—ã—Ö –ø–æ–∑–∏—Ü–∏—è—Ö, 5-–π –∫—É–±–∏–∫ ‚Äî –ª—é–±–æ–π). 30 –æ—á–∫–æ–≤.</li>
        <li><strong>–ë–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç:</strong> –≤—Å–µ <u>–ø—è—Ç—å –ø–æ–¥—Ä—è–¥</u> –∑–Ω–∞—á–µ–Ω–∏–π (<code>1-2-3-4-5</code> –∏–ª–∏ <code>2-3-4-5-6</code>). 40 –æ—á–∫–æ–≤.</li>
        <li><strong>–Ø–¥–∑–∏:</strong> –≤—Å–µ –ø—è—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã—Ö ‚Äî 50 –æ—á–∫–æ–≤.</li>
        <li><strong>–®–∞–Ω—Å:</strong> —Å—É–º–º–∞ –≤—Å–µ—Ö 5 –∫—É–±–∏–∫–æ–≤, –ª—é–±—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è.</li>
      </ul>
      <p><b>–†–∞—É–Ω–¥ –∑–∞–≤–µ—Ä—à—ë–Ω, –∫–æ–≥–¥–∞ –∑–∞–ø–æ–ª–Ω–µ–Ω—ã –≤—Å–µ –ø–æ–ª—è.</b><br>
      –ü–æ–±–µ–¥–∞ ‚Äî –µ—Å–ª–∏ –∑–∞ 3 —Ä–∞—É–Ω–¥–∞ —Å—É–º–º–∞ ‚â• <b>777</b> –æ—á–∫–æ–≤.</p>
      <p style="color:#888; font-size:0.98em;">–í–µ—Ä—Å–∏—è –¥–ª—è —Ç–µ—Å—Ç–∞, <span style="font-size:1.2em;">üé≤</span> <span class="rules-link" onclick="showTab('game')">–≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ –∏–≥—Ä–µ</span></p>
    </div>
  </div>
<script>
function showTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(tc => tc.classList.remove('active'));
  if(tab === 'game') document.querySelector('.tab-btn').classList.add('active');
  else document.querySelectorAll('.tab-btn')[1].classList.add('active');
  document.getElementById(tab).classList.add('active');
}

const upperFields = ["1", "2", "3", "4", "5", "6"];
const lowerFields = [
  "–ü–∞—Ä–∞", "–î–≤–µ –ø–∞—Ä—ã", "–°–µ—Ç", "–ö–∞—Ä–µ", "–§—É–ª–ª —Ö–∞—É—Å",
  "–ú–∞–ª—ã–π —Å—Ç—Ä–∏—Ç", "–ë–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç", "–Ø–¥–∑–∏", "–®–∞–Ω—Å"
];
const allFields = [...upperFields, ...lowerFields];

let scoreTable = {};
let round = 1, totalScore = 0, rollsLeft = 3;
let dice = [1,1,1,1,1];
let diceKeep = [false, false, false, false, false];
let roundScoreTables = [{}, {}, {}];

function resetScoreTable() {
  scoreTable = {};
  for (let f of allFields) scoreTable[f] = null;
}
function randomDice() { return Math.floor(Math.random()*6)+1; }
function drawDiceRow() {
  const dr = document.getElementById("dice-row");
  dr.innerHTML = '';
  for(let i=0; i<5; ++i) {
    const d = document.createElement('div');
    d.className = 'dice' + (diceKeep[i] ? ' selected' : '');
    d.innerHTML = diceEmoji(dice[i]);
    d.onclick = () => {
      if (rollsLeft < 3 && rollsLeft > 0) {
        diceKeep[i] = !diceKeep[i];
        drawDiceRow();
      }
    }
    dr.appendChild(d);
  }
}
function diceEmoji(val) {
  return ['‚öÄ','‚öÅ','‚öÇ','‚öÉ','‚öÑ','‚öÖ'][val-1];
}
function rollDice() {
  for(let i=0; i<5; ++i)
    if (!diceKeep[i]) dice[i] = randomDice();
  drawDiceRow();
}
function animateRoll(cb) {
  let times = 10;
  let interval = setInterval(()=>{
    for(let i=0; i<5; ++i)
      if (!diceKeep[i]) dice[i] = randomDice();
    drawDiceRow();
    if (--times == 0) {
      clearInterval(interval);
      cb && cb();
    }
  }, 60);
}
function countDice(arr) {
  let c = {};
  for(let i=1;i<=6;i++)c[i]=0;
  for(let d of arr)c[d]++;
  return c;
}
function possibleScores(dice, table) {
  const d = countDice(dice);
  let res = {};
  // –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫
  for(let f of upperFields)
    if(table[f] === null) res[f] = d[+f]*(+f);

  // –ü–∞—Ä–∞
  if(table["–ü–∞—Ä–∞"] === null) {
    res["–ü–∞—Ä–∞"] = 0;
    for(let i=6;i>=1;i--) {
      if(d[i]>=2) {
        res["–ü–∞—Ä–∞"] = dice.reduce((a,b)=>a+b,0);
        break;
      }
    }
  }
  // –î–≤–µ –ø–∞—Ä—ã
  if(table["–î–≤–µ –ø–∞—Ä—ã"] === null) {
    let pairs = 0;
    for(let i=1;i<=6;i++) if(d[i]>=2) pairs++;
    res["–î–≤–µ –ø–∞—Ä—ã"] = pairs >= 2 ? dice.reduce((a,b)=>a+b,0) : 0;
  }
  // –°–µ—Ç (—Ç—Ä–æ–π–∫–∞)
  if(table["–°–µ—Ç"] === null) {
    res["–°–µ—Ç"] = 0;
    for(let i=6;i>=1;i--) {
      if(d[i]>=3){
        res["–°–µ—Ç"] = dice.reduce((a,b)=>a+b,0);
        break;
      }
    }
  }
  // –ö–∞—Ä–µ
  if(table["–ö–∞—Ä–µ"] === null) {
    res["–ö–∞—Ä–µ"] = 0;
    for(let i=6;i>=1;i--) {
      if(d[i]>=4){
        res["–ö–∞—Ä–µ"] = dice.reduce((a,b)=>a+b,0);
        break;
      }
    }
  }
  // –§—É–ª–ª —Ö–∞—É—Å
  if(table["–§—É–ª–ª —Ö–∞—É—Å"] === null) {
    let three=0, pair=0;
    for(let i=6;i>=1;i--) {
      if(d[i]==3) three=i;
      else if(d[i]==2) pair=i;
    }
    res["–§—É–ª–ª —Ö–∞—É—Å"] = (three && pair) ? 25 : 0;
  }
  // --- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –º–∞–ª—ã–π —Å—Ç—Ä–∏—Ç ---
  if(table["–ú–∞–ª—ã–π —Å—Ç—Ä–∏—Ç"] === null) {
    const unique = [...new Set(dice)];
    unique.sort((a,b)=>a-b);
    let hasSmallStraight = false;
    for (let seq of [
      [1,2,3,4],
      [2,3,4,5],
      [3,4,5,6]
    ]) {
      if (seq.every(x=>unique.includes(x))) {
        hasSmallStraight = true;
        break;
      }
    }
    res["–ú–∞–ª—ã–π —Å—Ç—Ä–∏—Ç"] = hasSmallStraight ? 30 : 0;
  }
  // --- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –±–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç ---
  if(table["–ë–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç"] === null) {
    let hasLargeStraight =
      [1,2,3,4,5].every(x=>dice.includes(x)) ||
      [2,3,4,5,6].every(x=>dice.includes(x));
    res["–ë–æ–ª—å—à–æ–π —Å—Ç—Ä–∏—Ç"] = hasLargeStraight ? 40 : 0;
  }
  // –Ø–¥–∑–∏
  if(table["–Ø–¥–∑–∏"] === null) {
    res["–Ø–¥–∑–∏"] = Object.values(d).includes(5) ? 50 : 0;
  }
  // –®–∞–Ω—Å
  if(table["–®–∞–Ω—Å"] === null) {
    res["–®–∞–Ω—Å"] = dice.reduce((a,b)=>a+b,0);
  }
  return res;
}
function drawTable() {
  let table = document.getElementById("score-table");
  // –ó–∞–≥–æ–ª–æ–≤–æ–∫
  let html = `<tr>
    <th>–ü–æ–ª–µ</th>
    <th>–†–∞—É–Ω–¥ 1</th>
    <th>–†–∞—É–Ω–¥ 2</th>
    <th>–†–∞—É–Ω–¥ 3</th>
  </tr>`;
  // –í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫
  html += `<tr><th colspan="4">–í–µ—Ä—Ö–Ω–∏–π –±–ª–æ–∫</th></tr>`;
  let upperSums = [0,0,0];
  for (let f of upperFields) {
    html += `<tr><td>${f}</td>`;
    for (let r = 0; r < 3; r++) {
      let val = roundScoreTables[r][f] !== undefined && roundScoreTables[r][f] !== null ? roundScoreTables[r][f] : "";
      if(val!=="") upperSums[r] += val;
      html += `<td${r+1===round?' style="background:#2ecc4022;"':''}>${val}</td>`;
    }
    html += "</tr>";
    // –°—É–º–º–∞ –∏ –±–æ–Ω—É—Å –ø–æ—Å–ª–µ 6-–∫–∏
    if (f==="6") {
      html += `<tr>
        <td><b>–°—É–º–º–∞ –≤–µ—Ä—Ö–Ω–µ–≥–æ –±–ª–æ–∫–∞</b></td>
        <td><b>${upperSums[0]}</b></td>
        <td><b>${upperSums[1]}</b></td>
        <td><b>${upperSums[2]}</b></td>
      </tr>`;
      html += `<tr>
        <td><b>–ë–æ–Ω—É—Å (+35, –µ—Å–ª–∏ ‚â•63)</b></td>
        <td class="bonus">${upperSums[0]>=63?35:""}</td>
        <td class="bonus">${upperSums[1]>=63?35:""}</td>
        <td class="bonus">${upperSums[2]>=63?35:""}</td>
      </tr>`;
      // ------ –°—É–º–º–∞ –Ω–∏–∂–Ω–µ–≥–æ –±–ª–æ–∫–∞ ------
      let lowerSums = [0,0,0];
      for (let r = 0; r < 3; r++) {
        for (let ff of lowerFields) {
          let v = roundScoreTables[r][ff] !== undefined && roundScoreTables[r][ff] !== null ? roundScoreTables[r][ff] : 0;
          lowerSums[r] += v;
        }
      }
      html += `<tr>
        <td><b>–°—É–º–º–∞ –Ω–∏–∂–Ω–µ–≥–æ –±–ª–æ–∫–∞</b></td>
        <td><b>${lowerSums[0]}</b></td>
        <td><b>${lowerSums[1]}</b></td>
        <td><b>${lowerSums[2]}</b></td>
      </tr>`;
    }
  }
  // –ù–∏–∂–Ω–∏–π –±–ª–æ–∫
  html += `<tr><th colspan="4">–ù–∏–∂–Ω–∏–π –±–ª–æ–∫</th></tr>`;
  for (let f of lowerFields) {
    html += `<tr><td>${f}</td>`;
    for (let r = 0; r < 3; r++) {
      let val = roundScoreTables[r][f] !== undefined && roundScoreTables[r][f] !== null ? roundScoreTables[r][f] : "";
      html += `<td${r+1===round?' style="background:#2ecc4022;"':''}>${val}</td>`;
    }
    html += "</tr>";
  }
  // –ò—Ç–æ–≥ –∑–∞ –∫–∞–∂–¥—ã–π —Ä–∞—É–Ω–¥
  html += `<tr><td><b>–ò—Ç–æ–≥–æ –∑–∞ —Ä–∞—É–Ω–¥</b></td>`;
  let roundTotals = [];
  for (let r = 0; r < 3; r++) {
    let sum = 0;
    for (let f of allFields) {
      sum += roundScoreTables[r][f] || 0;
    }
    if (upperSums[r] >= 63) sum += 35;
    roundTotals[r] = sum;
    html += `<td><b>${sum || ""}</b></td>`;
  }
  html += "</tr>";
  // –û–±—â–∏–π —Å—á—ë—Ç –∏ —Å–∫–æ–ª—å–∫–æ –¥–æ –ø–æ–±–µ–¥—ã
  const totalAll = roundTotals.reduce((a,b)=>a+b,0);
  html += `<tr>
    <td colspan="4" style="text-align:right;">
      <b>–û–±—â–∏–π —Å—á—ë—Ç: ${totalAll}</b> &nbsp;&nbsp; 
      <span style="color:${777-totalAll<=0?'#39b54a':'#e74c3c'};">
        ${777-totalAll>0 ? `–û—Å—Ç–∞–ª–æ—Å—å –¥–æ –ø–æ–±–µ–¥—ã: ${777-totalAll}` : '–ü–æ–±–µ–¥–∞!'}
      </span>
    </td>
  </tr>`;
  table.innerHTML = html;
}
function showPossibleMoves(poss) {
  let arr = Object.entries(poss).filter(([k,v])=>scoreTable[k]===null);
  if(arr.length===0) return "";
  let html = "<b>–í—ã–±–µ—Ä–∏ –∫—É–¥–∞ –∑–∞–ø–∏—Å–∞—Ç—å:</b> ";
  html += arr.map(([k,v])=>`<span class="available" onclick="chooseField('${k}')">${k} <b>(${v})</b></span>`).join(' | ');
  document.getElementById("possible-moves").innerHTML = html;
}
function hidePossibleMoves() {
  document.getElementById("possible-moves").innerHTML = "";
}
function chooseField(field) {
  const poss = possibleScores(dice, scoreTable);
  if(scoreTable[field]!==null)return;
  scoreTable[field]=poss[field];
  roundScoreTables[round-1][field] = poss[field];
  drawTable();
  hidePossibleMoves();
  let finished = allFields.every(f=>scoreTable[f]!==null);
  rollsLeft=3;
  diceKeep=[false,false,false,false,false];
  document.getElementById("roll-btn").disabled=false;
  document.getElementById("rolls-info").innerHTML="";
  document.getElementById("game-msg").innerHTML="";
  drawDiceRow();
  if(finished){
    document.getElementById("game-msg").innerHTML = `<b>–†–∞—É–Ω–¥ ${round} –∑–∞–≤–µ—Ä—à—ë–Ω!</b>`;
    setTimeout(()=>{
      if(round<3){
        round++;
        startRound();
      } else {
        showFinal();
      }
    }, 1500);
  }
}
function startRound() {
  resetScoreTable();
  rollsLeft=3;
  dice=[1,1,1,1,1];
  diceKeep=[false,false,false,false,false];
  document.getElementById("final-block").classList.add("hide");
  document.getElementById("round-info").innerHTML = `<b>–†–∞—É–Ω–¥ ${round} –∏–∑ 3</b>`;
  document.getElementById("game-msg").innerHTML = "";
  drawDiceRow();
  drawTable();
  hidePossibleMoves();
  document.getElementById("roll-btn").disabled=false;
  document.getElementById("rolls-info").innerHTML="–ë—Ä–æ—Å–∫–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å: <b>3</b>";
}
function showFinal() {
  let roundTotals = [];
  let upperSums = [0,0,0];
  for (let r = 0; r < 3; r++) {
    for (let f of upperFields) {
      let val = roundScoreTables[r][f] !== undefined && roundScoreTables[r][f] !== null ? roundScoreTables[r][f] : 0;
      upperSums[r] += val;
    }
  }
  for (let r = 0; r < 3; r++) {
    let sum = 0;
    for (let f of allFields) {
      sum += roundScoreTables[r][f] || 0;
    }
    if (upperSums[r] >= 63) sum += 35;
    roundTotals[r] = sum;
  }
  totalScore = roundTotals.reduce((a,b)=>a+b,0);
  document.getElementById("final-block").classList.remove("hide");
  document.getElementById("final-block").innerHTML = `<div>–í–∞—à —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Å—á—ë—Ç –∑–∞ 3 —Ä–∞—É–Ω–¥–∞: <b>${totalScore}</b><br>
  ${totalScore>=777 ? "üéâ <b>–ü–û–ë–ï–î–ê!</b> üéâ" : "üò¢ –ù–µ —Ö–≤–∞—Ç–∏–ª–æ –æ—á–∫–æ–≤ –¥–æ 777.<br>–ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑!"}
  <br><br><button class="btn" onclick="restartGame()">–°—ã–≥—Ä–∞—Ç—å —Å–Ω–æ–≤–∞</button></div>`;
}

let playerName = "";

function startGameWithName() {
  const nameInput = document.getElementById("player-name").value.trim();
  if (!nameInput) return alert("–í–≤–µ–¥–∏—Ç–µ –∏–º—è!");
  playerName = nameInput;
  document.getElementById("name-modal").style.display = "none";
  startRound();
}

function saveScore(name, score) {
  const scores = JSON.parse(localStorage.getItem("yahtzee_scores") || "[]");
  scores.push({ name, score, date: new Date().toISOString() });
  scores.sort((a, b) => b.score - a.score);
  localStorage.setItem("yahtzee_scores", JSON.stringify(scores.slice(0, 10)));
}

function drawLeaderboard() {
  const scores = JSON.parse(localStorage.getItem("yahtzee_scores") || "[]");
  if (scores.length === 0) return;
  let html = "<h3>üèÜ –¢–∞–±–ª–∏—Ü–∞ –ª–∏–¥–µ—Ä–æ–≤</h3><table class='score-table'><tr><th>–ò–º—è</th><th>–û—á–∫–∏</th><th>–î–∞—Ç–∞</th></tr>";
  for (const s of scores) {
    html += `<tr><td>${s.name}</td><td>${s.score}</td><td>${new Date(s.date).toLocaleDateString()}</td></tr>`;
  }
  html += "</table>";
  document.getElementById("final-block").innerHTML += html;
}

window.restartGame = function() {
  round = 1;
  roundScoreTables = [{}, {}, {}];
  startRound();
}
document.getElementById("roll-btn").onclick = function() {
  if(rollsLeft>0){
    document.getElementById("roll-btn").disabled=true;
    animateRoll(()=>{
      rollsLeft--;
      document.getElementById("roll-btn").disabled=rollsLeft==0;
      document.getElementById("rolls-info").innerHTML = `–ë—Ä–æ—Å–∫–æ–≤ –æ—Å—Ç–∞–ª–æ—Å—å: <b>${rollsLeft}</b>`;
      if(rollsLeft==0){
        const poss = possibleScores(dice, scoreTable);
        showPossibleMoves(poss);
        document.getElementById("game-msg").innerHTML="–í—ã–±–µ—Ä–∏ –ø–æ–ª–µ –¥–ª—è –∑–∞–ø–∏—Å–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞.";
      } else {
        document.getElementById("game-msg").innerHTML = "–í—ã–¥–µ–ª–∏ –∫—É–±–∏–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —Ö–æ—á–µ—à—å –ø–µ—Ä–µ–∫–∏–¥—ã–≤–∞—Ç—å, –∑–∞—Ç–µ–º —Å–Ω–æ–≤–∞ –±—Ä–æ—Å–∞–π.";
      }
    });
  }
};
window.onload = startRound;
</script>
</body>
</html>
